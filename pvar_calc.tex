\documentclass[12pt, a4paper]{article}

\usepackage[utf8]{inputenc}

\usepackage{lmodern}
\usepackage{layouts}                    % layouto vienetu transformacijos  
\usepackage[hyperref]{ntheorem}         % leidzia pakesti theoremu stiliu

\usepackage{amssymb}
\usepackage{amsmath}
% \usepackage{listings}            % graziam kodui
\usepackage{enumerate}

% grafo braizymui
\usepackage{tikz}
\usetikzlibrary{shapes,arrows}




% \usepackage{caption}                    % paveikleliu dejimas i veina vieta
% \usepackage{subcaption}                 % paveikleliu dejimas i veina vieta


% \usepackage{microtype}				          % isjungia triukus, kuriu nereikia
% \DisableLigatures[f]{encoding = *, family = * }

\usepackage{ifpdf}
\ifpdf
\usepackage{pdfpages}
\usepackage[pdftex]{hyperref}
\fi

% psiaudokodas rasymui
\usepackage{algorithm}
\usepackage{algpseudocode}
\algrenewcommand{\algorithmiccomment}[1]{\hskip2em// #1}
\algnewcommand\algorithmicoutput{\textbf{Output:}}
\algnewcommand\Output{\item[\algorithmicoutput]}

% Trumpiniu apibrezimai 
\DeclareMathOperator*{\argmax}{arg\,max} 
\def\lc{\left\lceil}   
\def\rc{\right\rceil}
 
% stanratiniu fontu nustatymas
% \renewcommand{\sfdefault}{uhv}
% \renewcommand{\rmdefault}{utm}
% \renewcommand{\ttdefault}{ucr}


\theorembodyfont{\normalfont}
\theoremseparator{.}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{corollary}[theorem]{Corollary}


\newenvironment{proof}[1][Proof]{\noindent \textbf{#1.} }{\  \rule{0.5em}{0.5em}}
\numberwithin{equation}{section}

\title{The calculus of $p$-variation }
\author{Vygantas Butkus and Rimas Norvaiša \\
\small{Institute of Mathematics and Informatics, Akademijos 4, LT-08663 Vilnius, Lithuania}}
\date{\today}




\begin{document}
  \maketitle

\begin{algorithm}
\caption{Euclid’s algorithm}\label{euclid}
\begin{algorithmic}[1]
\Procedure{Euclid}{$a,b$}\Comment{The g.c.d. of a and b}
\State $r\gets a\bmod b$
\While{$r\not=0$}\Comment{We have the answer if r is 0}
\State $a\gets b$
\State $b\gets r$
\State $r\gets a\bmod b$
\EndWhile\label{euclidendwhile}
\State \textbf{return} $b$\Comment{The gcd is b}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{abstract}
Your abstract goes here...
...
\end{abstract}



\section{Introduction}

% Pirmą kartą p-variacija buvo apibrėžta Wiener darbe [20] dar 1924 me-
%tais. Vėliau p-variacijos tyrimus išplėtojo autorius L. C. Young darbe [21]. %Daug ir
%išsamios informacijos apie žinomas p-variacijos savybes galima rasti R. %Norvaišos ir
%R. M. Dudley knygose [8] ir [9] – ten suformuluota ir įrodyta daug p-%variacijos savybių
% bei pateikta išsami p-variacijos bibliografija.

The $p$-variation is a generalization of the total variation of a function,
namely, it is supremum of the sums of the $p$-th
powers of absolute increments off over nonoverlapping intervals 
(the formal definition is given in Definition~\ref{def:pvar}).
The total variation is a special case of $p$-variation, then 
$p=1$, i.e. the total variation is equal to $1$-variation.

The $p$-variation was first defined by Wiener in 1924 \cite{Wiener1924}.
In this work, the main focus was on $2$-variation. 
Later on, Young extended
the topic of $p$-variation in his work \cite{Young1936}, there 
he analysed $p$-variations with $p \neq 2$. 
Lots and detailed information on the known properties 
of $p$-variation can be found in the books of  Norvaiša and
Dudley (see \cite{DudleyNorvaisa1998} and \cite{DudleyNorvaisa1999}). 
There is formulated and proved a lot of the properties of $p$-variation.
In addition, the comprehensive bibliography of $p$-variation is include.

A regulated function $f$ is called \emph{rough}
if its $1$-variation value is infinite.
The class of rough functions appears to be quite an important one.
Probably the best know example of rough function is 
a trajectory of Wiener process. 
The Wiener is a well known process (see \cite{Karatsas1997}) 
are used in statistics, physics and economic (\cite{Econ1997}).
It is worth noting, that rough functions can not be investigated 
with regular tools of calculus as derivative or Lebesgue–Stieltjes integral.
The $p$-variation plays an important role in the filed of
rough function analysis. 
Firstly, the $p$-variation gives a convenient way to measure 
a degree of roughness. 
Secondly, it appears that $p$-variation is a very useful tool 
in calculus of rough functions.
A good overview of the importance of $p$-variation in rough function
analysis is given in \cite{Norvaisa2005}.
 
  
The exact value of $p$-variation was not used to be a topic.
Rather, the primary focus on $p$-variation properties 
is whether the $p$-variation bounded or unbounded. 
But the the work \cite{NorvaisaRackauskas2008} presented by
Norvaiša and Račkauskas greatly increased the motivation
of obtaining the the exact value of $p$-variation.
The work \cite{NorvaisaRackauskas2008} presents
necessary and sufficient conditions
for the convergence in law of partial sum processes in
$p$-variation norm. 
The result could be applied in the statistical data analysis,
which uses $p$-variation as data statistics.
For applying those theoretical result in data analysis it is necessary
to have procedure that actually calculates the value of $p$-variation.
Nonetheless, it seams that there is no proposed 
procedure of calculation of $p$-variation value.

The main goal of this article is to present the algorithm,
which calculates $p$-variation of the sample
(see Def.~\ref{def:pvarseq}), and give all the mathematical proofs
of the properties that were used in this algorithm.
The algorithm is denoted as \emph{pvar}.
It is already realised in the R environment (see~\cite{R})
and it is publicly available in \emph{pvar} package on CRAN\footnotemark.
It is worth noting, that this procedure could be used to calculate
$p$-variation of any piecewise monotone function.
\footnotetext{
http://cran.r-project.org/web/packages/pvar/index.html
}

The mathematical properties that where used in the
algorithm are presented and proved in the next section of this article.
In addition, all known properties that are relevant to this work
are listed with the reference to original works. Namely, in large extent
we use the properties presented in J.~Qian Ph.D. thesis \cite{Qian}\footnotemark.
And in the Section~\ref{sec:pvarcalc} we will present the \emph{pvar}
algorithm that calculates the $p$-variation of the sample.


\footnotetext{
The main result of J. Qian Ph.D. thesis are presented in article \cite{Qian1998}.
}

\section{Mathematical analysis}

% terminu variacijos:
%Turning points
%lap - the monotonic interval
%corner
%local extrema
%forward (backward) maximum (minimum) (extrema) 

\begin{itemize}  
  \item $PP[a,b]$ --  the set of all point partitions of $[a,b]$
    (def.~\ref{def:pp}).
  \item $s_{p}(f;\kappa)$ --  $p$-variation sum (def.~\ref{def:pvar}).
  \item $v_{p}\left( f\right)$ -- $p$-variation of the function $f$
    (def.~\ref{def:pvar}).
  \item $SP_{p}(f,[a,b])$ -- the set of supreme partitions
    (def.~\ref{def:pvar}).
  \item $\overline{SP}_{p}(f,[a,b])$ -- a set of points that are
    in any supreme partition (def.~\ref{def:psp}).
  \item $PM[a,b]$ -- a set of piecewise monotone functions
    (def.~\ref{def:PM}).  
  \item $CPM[a,b]$ -- a set of continuous piecewise monotone functions
    (def.~\ref{def:PM}).
  \item $K(f,[a,b])$ -- minimal size of PM partitions
    (prop.~\ref{prop:K_f}).
  \item $X(f,[a,b])$ -- the set of PM partitions with minimal size
    (def.~\ref{def:X_f}).
\end{itemize} 


\subsection{General known properties}
  
  
%%% Definition of partition %%% 
% Status
\begin{definition}[Partition]\label{def:pp}
  Let $J = [a,b]$ be a closed interval of real numbers with 
  $-\infty < a \leq b <+\infty$. 
  If $a < b$, an ordered set $\kappa = \{x_{i}\}_{i=0}^{n}$ 
  of points in $[a,b]$ such that a  
  $a=x_{0}<x_{1}<x_{2}<...<x_{n}=b$ is called a \emph{(point) partition}. 
  The size of the partition is denoted $\left|\kappa \right| :=\#\kappa-1=n$. 
  The set of all point partitions of $[a,b]$ is denoted by $PP[a,b]$.  
\end{definition} 
 
%%% Definition of $p$-variation %%% 
% Status:OK
\begin{definition}[$p$-variation]\label{def:pvar}
  Let $f:[a,b] \rightarrow \mathbb{R}$ be a real function from 
  an interval $[a,b]$.
  If $a<b$, for  $\kappa =\{x_{i}\}_{i=0}^{n} \in PP[a,b]$ 
  the \emph{$p$-variation sum} is 
  \begin{equation}\label{eq:def_pvarsum}
    s_{p}(f,\kappa):=\sum_{i=1}^{n}| f( x_{i}) -f( x_{i-1})|^{p},
  \end{equation}
  where $0<p<\infty $. Thus, the \emph{$p$-variation} 
  of $f$ over $[a,b]$ is $0$ if $a = b$ and otherwise
  \begin{equation}\label{eq:def_pvar}
    v_{p}(f) =v_{p}(f,[a,b]) :=\sup \left\{
    s_{p}(f,\kappa ):\kappa \in PP[a,b]\right\}.    
  \end{equation}
  
  The partition $\kappa$ is called \emph{supreme partition} 
  if it satisfies the property $v_{p}(f) = s_{p}(f,\kappa)$.
  The set of such partitions is denoted
  $SP_{p}(f,[a,b])$.
  
\end{definition}  
 
Vidinis Komentaras (VK): Dar neaisku kaip pakrikstyti skaidini, kuris pasiekia supremuma. 
 
 
 
%%% THe properties of $p$-variation %%% 
% Status:OK 
\begin{lemma}[Elementary properties]\label{lm:element_properties} 
  Let $f:[a,b] \rightarrow \mathbb{R}$ and $0<p<\infty $. 
  Then the following $p$-variation properties holds
  \begin{enumerate}[a)]
    \item \label{lm:ep_a} $ v_p(f,[a,b]) \geq 0 $,
    \item \label{lm:ep_b} $ v_p(f,[a,b]) = 0 \Leftrightarrow f \equiv Const. $,
    \item \label{lm:ep_c} $ \forall C \in \mathbb{R}: v_p(f+C,[a,b]) = v_p(f,[a,b]) $,  
    \item \label{lm:ep_d} $ \forall C \in \mathbb{R}: v_p(Cf,[a,b]) = C^p v_p(f,[a,b]) $,  
    \item \label{lm:ep_e} $ \forall c \in [a,b]: v_p(f,[a,b]) \geq v_p(f,[a,c]) + v_p(f,[c,b]) $,  
    \item \label{lm:ep_f} $ \forall [a',b'] \subset [a,b] : v_p(f,[a,b]) \geq v_p(f,[a',b']) $.  
    \item \label{lm:ep_g} $ \forall \kappa \in PP[a,b]:s_{p}(f;\kappa) \leq v_p(f,[a,b]) $.  
  \end{enumerate}

  All listed properties are elementary derived directly form the $p$-variation definition.
\end{lemma}
 
 

%%% Regulated function (definition) %%% 
% Status:OK  
\begin{definition}[Regulated function](\cite{Qian}, Def. 3.1)
  For any interval $J$, which may be open or closed at either end, 
  real function $f$ is called \emph{regulated} on $J$ 
  if it has left and right limits   
  $f(x-)$ and $f(x+)$ respectively at each point $x$ in interior of $J$,
  a right limit at the left end point and a left limit 
  at the right endpoint.
\end{definition}  
 
%%% Limit points %%% 
% Status:OK   
\begin{proposition}(\cite{Qian}, Lemma 3.1)\label{prop:LimPoints} 
  Let $1 \leq p < \infty$. If $f$ is regulated then $v_{p}(f)$ remains the same
  if points $x+$, $x-$ are allowed as partition points $x_i$ in the definition \ref{def:pvar}.
\end{proposition}  
 
%%% Piecewise monotone functions (definition) %%% 
% Status:OK    
\begin{definition}[Piecewise monotone functions](\cite{Qian}, Def. 3.2)\label{def:PM}
  A regulated real-valued function $f$ on closed interval $[a,b]$ 
  will be called \emph{piecewise monotone} (PM)
  if there are points $a=x_0<\dots<x_k=b$ for some finite $k$ such 
  that $f$ is monotone on each interval $[x_{j-1},x_j],\;j=1,\dots,k$. 
  Here for $j=1,\dots,k-1$, $x_j$ may be point $x-$ or $x+$.
  The set of all piecewise monotone functions is denoted $PM=PM[a,b]$.
  
  In addition to PM, if $f$ is continuous function we will call it 
  continuous piecewise monotone(CPM). 
  The set of such functions is denoted $CPM=CPM[a,b]$. 
\end{definition}   


 
%%% Minimal size of the partitions %%% 
% Status:OK    
\begin{proposition}(\cite{Qian}, Prop. 3.1)\label{prop:K_f}
  If $f$ is PM, there is a minimal size of partition $|\kappa|$ for which the definition \ref{def:PM} holds.
  The minimal size of the the PM partition is denoted $K(f,[a,b])=K(f)$, namely
  \begin{equation}
  K(f):=\min\left\{n:\exists \{x_{i}\}_{i=0}^{n} \in PP[a,b]:  f \text{ is monotonic in each } [x_{j-1}, x_j]   \right\}.
  \end{equation}
\end{proposition}    
 
%%% The set of minimal partitions %%% 
% Status:OK  
\begin{definition}[The set of PM partitions with minimal size](\cite{Qian}, Def. 3.3)\label{def:X_f}
  If $f$ is PM, let $X(f)=X(f,[a,b])$ be the set of all $\{x_{i}\}_{i=0}^{K(f)}$ for which the definition 
  of PM (def.~\ref{def:PM}) holds. $X(f)$ is called the \emph{set of PM partitions with minimal size}.
\end{definition}    
 
%%% uniqueness of difference of PM partition %%%
% Status:OK  
\begin{proposition}(\cite{Qian}, Prop. 3.3)\label{prop:PM_Unique}
  Let $f$ is PM then the numbers 
  $\alpha_j(f):=f(x_j) - f(x_{j-1})$ for
  $\{ x_j \}_{j=0}^{K(f)} \in X(f)$ and 
  $j=1,2,\dots K(f)$
  are uniquely determined.
\end{proposition}  
 
 
%%% PM form: alternating laps %%%
% Status: RECHECK  with orginal.
\begin{proposition}(\cite{Qian}, Prop. 3.2)\label{prop:PM_form}
  Let $f$ is PM. For any partition 
  $\{ x_j \}_{j=0}^{K(f)} \in X(f)$ 
  exactly one of the flowing stamens holds:
  \begin{enumerate}[(a)]
   \item $f(x_0)>f(x_1)<f(x_2)>\dots$. 
     Function $f$ is not
     increasing in intervals $[x_{2j}, x_{2j+1}]$, 
     then $2j+1\leq K(f)$. 
     Function $f$ is not
     decreasing in intervals $[x_{2j-1}, x_{2j}]$, 
     then $j \geq 1$ and $2j\leq K(f)$.  
     
   \item (a) holds for a function $-f$; or
   \item $K(f, [a,b]) = 1$ and $f$ is constant in interval $[a,b]$.
  \end{enumerate}
  
  
\end{proposition}  
  
 
 
%%% Equality by PM %%% 
% Status:OK 
\begin{definition}[The equality by PM](\cite{Qian}, Def. 3.4)\label{def:EqPM}
  If $f$, $g$ are two PM functions, possibly on different intervals, such that 
  $K(f)=K(g)$ and $\alpha_j(f)=\alpha_j(g)$ for $j=1,2,\dots,K(f)$, then we say that
  $f \stackrel{PM}{=} g$.
\end{definition}    
  
%%% f {DM}= g %%%
% Status:OK 
\begin{proposition}(\cite{Qian}, Cor. 3.1)\label{prop:f_PM_g}
  Let $p>1$ and functions $f$ and $g$ are PM. 
  If $f \stackrel{PM}{=} g$ or $f \stackrel{PM}{=} -g$, then $v_p(f)=v_p(g)$.
\end{proposition} 

%%% Exists meaningful partition in set of PM partition. %%%
% Status:OK 
\begin{proposition}(\cite{Qian}, Them. 3.1)\label{prop:sup_in_PM}
  Let $f$ is PM, $\kappa \in X(f)$ and $1 \leq p < \infty$. 
  Then the supremum of $p$-variation in Definition~\ref{def:pvar}
  is attained for some partition $r \subset  \kappa$.
\end{proposition} 
\begin{corollary}\label{cor:SPNotEmpty}
  The set $SP_{p}(f,[a,b])$ is not empty for all $f \in PM[a,b]$.  
\end{corollary}


%%% Sample function (definition) %%%
% Status:OK 
\begin{definition}[Sample function]\label{def:Seq2Fun}
  Suppose $X=\{X_{i}\}_{i=0}^{n}$ is any sequence real numbers. 
  We will call such sequence a \emph{sample}, 
  whereas $n$ will be referred to as a \emph{sample size}.
  Then the \emph{sample function}  
  $G_X:[0,n] \rightarrow \mathbb{R}$ is defined as 
  \begin{eqnarray}
    G_X(t) := X_{\lfloor t \rfloor},\;t\in[0,n],
  \end{eqnarray}
  where $\lfloor t \rfloor$ denotes floor function at point $t$. 
\end{definition} 

%%% $p$-variation of the sequence (definition) %%%
% Status:OK 
\begin{definition}[$p$-variation of the sequence]\label{def:pvarseq}
  Let $X=\{X_i\}_{i=0}^n$. The $p$-variation
  of the sample $X$ is defined as $p$-variation of the 
  function $G_X(t)$, namely
  \begin{equation}
    v_p(X) := v_p(G_X(t),[0,n]).
  \end{equation}
\end{definition}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{General properties with proofs}


%%% VIP: p-variation is additive in meaningful points %%%
\begin{proposition}\label{prop:pvar_sum_x} 
  Let $f:[a,b] \rightarrow \mathbb{R}$ be PM and
  $\{x_i\}_{i=0}^n \in PP[a,b]$ is any partition of interval $[a,b]$. 
  Then the statement 
  \begin{equation}
    \exists \kappa \in SP_{p}(f,[a,b]):\forall i,x_i \in \kappa
  \end{equation}
  is equivalent to 
  \begin{equation}
    v_p(f,[a,b]) = \sum_{i=1}^n v_p(f,[x_{i-1},x_i]).
  \end{equation}
\end{proposition}
\begin{proof}
  Necessary. Let $f:[a,b] \rightarrow \mathbb{R}$ be PM,
  $\{x_i\}_{i=0}^n \in PP[a,b]$ and 
  \begin{equation}
    \exists \kappa \in SP_{p}(f,[a,b]):\forall i,x_i \in \kappa. 
  \end{equation}
  
  Points from the partition $\kappa$ will be denoted $t_i$, 
  i.e. $\kappa=\{t_i\}_{i=0}^m$.
  Then, according to definitions of $SP_{p}$ and 
  $p$-variation (def.~\ref{def:pvar}) the following equation holds
  \begin{equation}\label{eq:ir1.eq1}
  v_p(f,[a,b])=s_{p}(f;\kappa)=\sum_{j=1}^{m}|f(t_{j-1})-f(t_j)|^p 
    = \sum_{i=1}^n\sum_{j=h(i-1)+1}^{h(i)}|f(t_{j-1})-f(t_j)|^p,
  \end{equation}  
  where $h:\{0,1,\dots,n\} \rightarrow \{0,1,\dots,m\}$ 
  denotes a function 
  from the set of index of $x$ to the set of index of $t$, namely:
  \begin{equation}\label{eq:ir1.eqx1}
    h(i):=(j_i : x_i = t_{j_i}=t_{h(i)}).
  \end{equation}  
  The equation (\ref{eq:ir1.eq1}) holds, because all the elements 
  in the sum remains, we just grouped them.
  
  Moreover, the inequality  
  \begin{equation}\label{eq:ir1.eq2}
  \sum_{j=h(i-1)+1}^{h(i)}|f(t_{j-1})-f(t_j)|^p 
    \leq v_p(f,[x_{i-1},x_i])
  \end{equation}  
  holds according to Lemma \ref{lm:element_properties}(\ref{lm:ep_g}).
  
  As a result of (\ref{eq:ir1.eq1}) and (\ref{eq:ir1.eq2}) we get
  \begin{equation}\label{eq:ir1.eq3}
    v_p(f,[a,b]) \leq \sum_{i=1}^n v_p(f,[x_{i-1},x_i]).
  \end{equation}
  
  On the other hand, according to the same
  Lemma~\ref{lm:element_properties}(\ref{lm:ep_e}) 
  the following inequality holds
  \begin{equation}\label{eq:ir1.eq4}
    v_p(f,[a,b]) \geq \sum_{i=1}^n v_p(f,[x_{i-1},x_i]).
  \end{equation}
  
  Finally, from the (\ref{eq:ir1.eq3}) and (\ref{eq:ir1.eq4}) follows 
  \begin{equation}\label{eq:ir1.eq5}
    v_p(f,[a,b]) = \sum_{i=1}^n v_p(f,[x_{i-1},x_i]).
  \end{equation}
  
  Sufficiency. Suppose $f:[a,b] \rightarrow \mathbb{R}$ and 
  \begin{equation}\label{eq:ir1.eq6}
    v_p(f,[a,b]) = \sum_{i=1}^n v_p(f,[x_{i-1},x_i]).
  \end{equation}
  
  According to Corollary~\ref{cor:SPNotEmpty}, 
  sets $SP_{p}(f,[x_{i-1},x_i]),\;i=1,\dots,n$ are not empty.  
  Lets take any partition from each of the 
  sets $SP_{p}(f,[x_{i-1},x_i]),\;i=1,\dots,n$ and denote it $\kappa_i$.
    
  
  Then, let define a joint partition $\kappa:=\cup_{i=1}^n \kappa_i$. 
  Points from the partition $\kappa$ will be denoted by $t_i$. 
  In addition, we will use the function $h$, 
  which is defined in (\ref{eq:ir1.eqx1}).
  Then, continuing the equation (\ref{eq:ir1.eq6}) we get
  \begin{equation}\label{eq:ir1.eq7}
  v_p(f,[a,b]) = 
    \sum_{i=1}^n\sum_{j=h(i-1)+1}^{h(i)}|f(t_{j-1})-f(t_j)|^p
    =\sum_{i=1}^{|\kappa|}|f(t_{i-1})-f(t_i)|^p.
  \end{equation}
  This means that $\kappa \in MP_{p}(f,[a,b])$. 
  Moreover, $\forall i:x_i \in \kappa$,
  because $\kappa=\cup_{i=1}^n \kappa_i$.  
\end{proof}


% The subset on the points of supreme partition is aditive
\begin{lemma}\label{lm:pvarSubset}
  Let $f:[a,b] \rightarrow \mathbb{R}$ be PM 
  and $\{x_i\}_{i=0}^{n} \subset \kappa \in SP_{p}(f,[a,b])$. Then
  \begin{equation}
    \forall k,l: v_p(f,[x_k,x_l]) = 
      \sum_{i=k+1}^l v_p(f,[x_{i-1},x_i]),\; 0 \leq k<l\leq n. 
  \end{equation}
\end{lemma}
\begin{proof}
  Suppose $\{x_i\}_{i=0}^{n} \subset \kappa \in SP_{p}(f,[a,b])$. 
  Let choose $k$ and $l$ such that $0\leq k<l\leq n$.
  Lets apply Proposition~\ref{prop:pvar_sum_x} for the partition
  $\{x_0,x_k,x_{k+1},\dots,x_{l-1},x_l,x_n\}$. Thus,
  \begin{equation}
    v_p(f,[a,b]) = v_p(f,[x_{0},x_k]) 
      + \sum_{i=k+1}^l v_p(f,[x_{i-1},x_i]) + v_p(f,[x_l,x_n]). 
  \end{equation}
  In addition, we can apply the same proposition for 
  the partition $\{x_0,x_k,x_l,x_n\}$, then
  \begin{equation}
    v_p(f,[a,b]) =  v_p(f,[x_{0},x_k]) + v_p(f,[x_k,x_l]) 
      + v_p(f,[x_l,x_n]). 
  \end{equation}
  By subtracting one equation form the other we get the result that
  \begin{equation}
    v_p(f,[x_k,x_l])= \sum_{i=k+1}^l v_p(f,[x_{i-1},x_i]). 
  \end{equation}
\end{proof}

\begin{lemma}\label{lm:spSubset}
  Let $f:[a,b] \rightarrow \mathbb{R}$ be PM 
  and $\{t_i\}_{i=0}^{n} \in SP_{p}(f,[a,b])$. Then
  \begin{equation}
    \forall k,l: v_p(f,[t_k, t_l]) = 
      s_p\left(f,\{t_i\}_{i=k}^{l}\right) ,\; 0 \leq k<l\leq n. 
  \end{equation}
\end{lemma}
\begin{proof}
  Let $f:[a,b] \rightarrow \mathbb{R}$ be PM 
  and $\{t_i\}_{i=0}^{n} \in SP_{p}(f,[a,b])$. 
  Let choose $k$ and $l$ such that $0\leq k<l\leq n$.
  Then 
  \begin{eqnarray}
    v_p(f, [a, b]) & = & s_p(f,\{t_i\}_{i=0}^{n}) \\
    & = & s_p(f,\{t_i\}_{i=0}^{k})+s_p(f,\{t_i\}_{i=k}^{l})
      +s_p(f,\{t_i\}_{i=l}^{n})\\
    \label{eq:spSubset_p1}  
    & \leq & v_p(f, [a,t_k]) + s_p(f,\{t_i\}_{i=k}^{l})
      +v_p(f, [t_l, b]).         
  \end{eqnarray}    
  The last inequality holds according to 
  Lemma~\ref{lm:element_properties}(\ref{lm:ep_g}).  
    
  On the other hand, from Proposition~\ref{lm:pvarSubset}
  we get
  \begin{equation}\label{eq:spSubset_p2}  
    v_p(f, [a, b]) = 
      v_p(f, [a,t_k]) + v_p(f,[t_k, t_l])
      +v_p(f, [t_l, b]).     
  \end{equation}      
  
  Form (\ref{eq:spSubset_p1}) and (\ref{eq:spSubset_p2})
  follows 
  \begin{equation} 
    v_p(f,[t_k, t_l]) \leq s_p(f,\{t_i\}_{i=k}^{l}).  
  \end{equation} 
  
  Finally, from Lemma~\ref{lm:element_properties}(\ref{lm:ep_g})
  we conclude that 
  \begin{equation} 
    v_p(f,[t_k, t_l]) = s_p(f,\{t_i\}_{i=k}^{l}).  
  \end{equation}   
  
\end{proof}


% The point of supreme partition 
\begin{definition}[The point of supreme partition]\label{def:psp}
  Let $f:[a,b] \rightarrow \mathbb{R}$ be PM.  
  The point $x$ will be called the \emph{point of supreme partition}
  if 
  \begin{equation}
    \exists \kappa \in SP_p(f, [a,b]): x \in \kappa.
  \end{equation} 
  The set of such points will be denoted by 
  $\overline{SP}_p(f, [a, b])$.
\end{definition}


\begin{lemma}\label{lm:psp} 
  Suppose $f:[a,b] \rightarrow \mathbb{R}$ is PM, 
  $x \in [a,b]$,
  $x \notin \overline{SP}_p(f, [a, b])$ and
  $\{t_i\}_{i=0}^n \in SP(f, [a, b])$ is any supreme partition.
  Then, 
  \begin{equation}
    \exists j=1,\dots,n: x \in (t_{j-1}, t_j) \text{ and } 
    x \notin \overline{SP}_p(f, [t_{j-1}, t_j]).
  \end{equation}
\end{lemma}
\begin{proof}
  Suppose the assumptions of lemma is valid.
  Since $x \in [a,b]$ and $[a, b] = \cup_{i=1}^{n}[t_{i-1}, t_{i}]$,
  then 
  \begin{equation}\label{eq:psp_p1}
    \exists j=1,\dots,n:x \in [t_{j-1}, t_{j}].
  \end{equation}    
  Moreover, $x \notin \{t_i\}_{i=0}^n$, 
  because $x \notin \overline{SP}_p(f, [a, b])$, thus,
  $x \neq t_{j-1}$ and  $x \neq t_{j}$. 
  In addition to (\ref{eq:psp_p1}) this means that 
  $x \in (t_{j-1}, t_{j})$.
    
  Now, we will proof that 
  $x \notin \overline{SP}_p(f, [t_{j-1}, t_j])$.
  Suppose to the contrary that 
  $x \in \overline{SP}_p(f, [t_{j-1}, t_j])$. 
  Then, according to definition of 
  $\overline{SP}_p(f, [t_{j-1}, t_j])$, 
  \begin{equation}
    \exists \kappa \in SP_p(f, [t_{j-1}, t_j]): x \in \kappa.
  \end{equation}    
  Since, $\kappa \in SP_p(f, [t_{j-1}, t_j])$, 
  then 
  \begin{equation}
    v_p(f, [t_{j-1}, t_j])=s_p(f, \kappa)
  \end{equation} 
  
  Applying Proposition~\ref{prop:pvar_sum_x} 
  for partition $\{t_i\}_{i=0}^n$ we get
  \begin{eqnarray}
    v_p(f, [a, b]) &=& v_p(f, [t_{0}, t_{j-1}]) 
     + v_p(f, [t_{j-1}, t_j]) + v_p(f, [t_{j}, t_n])\\
     &=& s_p(f, \{t_i\}_{i=0}^{j-1}) 
     + s_p(f, \kappa) + s_p(f, \{t_i\}_{i=j}^{n}) 
  \end{eqnarray}
   
  This means that the partition 
  $r:=\{t_i\}_{i=0}^{j-1} \cup \kappa \cup \{t_i\}_{i=j}^{n}$
  is supreme partition, so 
  $x \in r \in SP(f, [a, b])$, therefore, by definition
  $x \in \overline{SP}_p(f, [a, b])$. 
  This contradict to initial assumption. 
\end{proof}


\begin{definition}[$f$-join]\label{def:fjoin}
  Suppose $f:[a,b] \rightarrow \mathbb{R}$ is PM.
  We will say that points $t_a$ and $t_b$ ($t_a<t_b$) 
  are \emph{$f$-joined} in interval $[a,b]$ if 
  \begin{equation}
    \exists \{x_j\}_{j=0}^{n} \in SP_{p}(f,[a,b]):
      [t_a,t_b]=[x_{j-1},x_j], \text{ with some } j.
  \end{equation}  
\end{definition}

% suziureti zenklus 
\begin{lemma}\label{lm:fjoin} 
  Suppose $f:[a,b] \rightarrow \mathbb{R}$ is PM and 
  points $t_a$ and $t_b$ ($t_a<t_b$) are 
  $f$-jointed in interval $[a,b]$.
  Then all following statements holds   
  \begin{enumerate}[a)]
    \item \label{lm:fjoin_a} 
    $v_p(f, [t_a,t_b] = \left|f(t_a)-f(t_b)\right|^p$;
    
    \item \label{lm:fjoin_b} 
    Let $x \in [t_a, t_b]$. 
    If $f(t_a) \geq f(t_b)$, then $f(t_a) \geq f(x) \geq f(t_b)$.
    If $f(t_a) \leq f(t_b)$, then $f(t_a) \leq f(x) \leq f(t_b)$;
    
  \end{enumerate}
\end{lemma}
\begin{proof}
  \paragraph*{a)}
  Let $f:[a,b] \rightarrow \mathbb{R}$  be PM, 
  $t_a<t_b$ and pair of points $t_a$, $t_b$ are $f$-joined. 
  Then exists $\{x_j\}_{j=0}^{n}$ and $j$ from the
  Definition~\ref{def:fjoin}.
  Thus, according to Lemma~\ref{lm:spSubset}
  \begin{equation}\label{eq:lm:fjoin_a}
    v_p(f,[t_{j-1}, t_j]) = 
      s_p\left(f,\{t_{j-1}, t_j\}\right) = \left|f(t_a)-f(t_b)\right|^p.
  \end{equation}      
  
  \paragraph*{b)}
  Let $f:[a,b] \rightarrow \mathbb{R}$ be PM 
  and points $t_a$ and $t_b$ are $f$-joined.
  Since $f \stackrel{PM}{=} -f$, with out loss of 
  generality we can assume that
  $f(t_a) \leq f(t_b)$.  
  Suppose to the contrary that $f(t_b)$ 
  is not an extrema of the function in interval $[t_a,t_b]$.
  Hence, $\exists c \in [t_a, t_b]: f(c)>f(t_b)$. Therefore,
  $|f(c)-f(t_a)|^p>|f(t_b)-f(t_a)|^p$.
  According to (\ref{eq:lm:fjoin_a}), 
  $v_p(f,[t_a,t_b])=|f(t_b)-f(t_a)|^p$, 
  thus, $|f(c)-f(t_a)|^p>v_p(f,[t_a,t_b])$,
  but this contradicts the definition of $p$-variation.  
  So, point $t_b$ must be an extrema in interval $[t_a,t_b]$.
  Symmetric arguments could be used for point $t_a$.  
  
  
\end{proof}




%%% The monotonisy of Sp function %%%
\begin{lemma}\label{prop:Sp_Monoton}
  Suppose $C \in \mathbb{R}$, 
  $c_1\geq0$ and $1\leq p<\infty$. 
  Then function
  $f:[0,\infty) \rightarrow \mathbb{R}$ with the values
  \begin{equation}
  f(x) = ( x + c_1  )^p - x^p - C,\;x \in [0,\infty),  
  \end{equation}
  are non decreasing in interval $[0,\infty)$. 
\end{lemma}
\begin{proof}
  Suppose $C \in \mathbb{R}$, $c_1\geq0$ and $1\leq p<\infty$. 
  Then, for all $x \geq 0$, the derivative of the function $f$ is
  \begin{eqnarray*} 
    f'(x)   &=& p(x+c_1)^{p-1} - px^{p-1} \\
          &\geq& px^{p-1} - px^{p-1} = 0.
  \end{eqnarray*}  
  The derivative of function $f$ is non negative, 
  thus the function $f$ is non decreasing, if $x \geq 0$.
\end{proof}
\begin{corollary}\label{cor:convex}
  Suppose $c_1\geq0$, $C \in \mathbb{R}$, $1\leq p<\infty$ 
  and $0 \leq x \leq y$. 
  Then the following implication holds 
  \begin{equation}
  |x + c_1 |^p > x^p + C \Rightarrow |y + c_1 |^{p} > y^{p} + C.  
  \end{equation}
\end{corollary}
\begin{proof}
  Suppose  $0 \leq x \leq y$. 
  Since $f$ is non decreasing, $f(x) \leq f(y)$.
  Therefore, if $f(x)>0$, then $f(y)>0$.
\end{proof}


%%% VIP: if pont is insignificant, then it will remain insignificant %%%
\begin{proposition}\label{prop:notinST} 
  Suppose $f:[a,b] \rightarrow \mathbb{R}$ is PM and
  $x \in [a', b'] \subset [a,b]$.    
  If $x \notin \overline{SP}_p(f, [a', b'])$, then 
  $x \notin \overline{SP}_p(f, [a, b])$. 
\end{proposition}

\begin{proof}
  Let $f:[a,b] \rightarrow \mathbb{R}$ be PM,
  $x \in [a', b'] \subset [a,b]$, 
  and $ x \notin \overline{SP}_p(f, [a', b'])$.
  Suppose to the contrary that
  $x \in \overline{SP}_p(f, [a, b])$.
  
  Since $x \in \overline{SP}_p(f, [a, b])$,
  according to the Definition~\ref{def:psp},
  \begin{equation} \label{eq:notinST_p1} 
    \exists \{t_i\}_{i=0}^n \in SP_p(f, [a, b]): x \in \{t_i\}_{i=0}^n.
  \end{equation}     
  
  Let $\{y_i\}_{i=0}^n \in SP_p(f, [a', b'])$ be any 
  supreme partition from the interval $[a', b']$. 
  Then, according to Lemma~\ref{lm:psp}, 
  \begin{equation} \label{eq:notinST_p2} 
    \exists j=1,\dots,n: x \in (y_{j-1}, y_j) \text{ and } 
    x \notin \overline{SP}_p(f, [y_{j-1}, y_j]).
  \end{equation}     
  Moreover, 
  \begin{equation}\label{eq:notinST_p3} 
    x \notin \{a, y_{j-1}, y_j, b\},
  \end{equation} 
  because $x \in (y_{j-1}, y_j) \subset [a, b]$.  
  Thus, from (\ref{eq:notinST_p1}) and (\ref{eq:notinST_p3}) 
  follows that  
  \begin{equation}\label{eq:notinST_p4}
    \exists r \in \{1,2,\dots,n-1\} : t_r = x.
  \end{equation}  

  Lets denote variables $l$ and $k$ by
  \begin{eqnarray*}
    l &:=& \max \left\{i \in \{1,2,\dots,n-1\} : 
      t_i  \in (y_{j-1}, y_j) \right\}, \\
    k &:= &\min \left\{i \in \{1,2,\dots,n-1\} : 
      t_i  \in (y_{j-1}, y_j) \right\}.
  \end{eqnarray*}  
  Since $x \in (y_{j-1}, y_j)$ and (\ref{eq:notinST_p4})~holds, 
  the values $l$ and $k$ always exists and $k \leq r \leq l$. 
  According to $l$ and $k$ definitions the following inequality holds  
  \begin{equation}\label{eq:notinST_p5}
    t_{k-1} \leq y_{j-1} < t_{k} \leq x \leq t_{l} < y_j \leq t_{l+1}.
  \end{equation}
  
 
  According to Lemma~\ref{lm:element_properties}(\ref{lm:ep_e})
  \begin{equation}\label{eq:notinST_p6}
    v_p(f,[y_{j-1},y_j]) \geq v_p(f,[y_{j-1},t_{k}]) 
      + v_p(f,[t_{k},t_{l}]) + v_p(f,[t_{l},y_j]),
  \end{equation}      
  Firstly, let suppose   
  \begin{equation}\label{eq:notinST_p7}
    v_p(f,[y_{j-1},y_j]) = v_p(f,[y_{j-1},t_{k}]) 
      + v_p(f,[t_{k},t_{l}]) + v_p(f,[t_{l},y_j]).
  \end{equation}   
  Lets take any supreme partitions from intervals
  $[y_{j-1},t_{k}]$ and  $[t_{l},y_j]$, namely
  $\kappa_k \in SP_p(f,[y_{j-1},t_{k}]$ and
  $\kappa_l \in SP_p(f,[t_{l},y_j]$.  
  In addition, since $\{t_i\}_{i=0}^n \in SP_p(f, [a, b])$,
  according to Lemma~\ref{lm:spSubset}
  $v_p(f,[t_{k},t_{l}]) = s_p(f,\{t_i\}_{i=k}^l)$.
  Therefore,
  \begin{equation*}\label{eq:notinST_p8}
    v_p(f,[y_{j-1},y_j]) = s_p(f,\kappa_k) 
      + s_p(f,\{t_i\}_{i=k}^l) + v_p(f,\kappa_l).
  \end{equation*}  
  This means, that 
  \begin{equation*}\label{eq:notinST_p8}
    \kappa_k \cup \{t_i\}_{i=k}^l \cup \kappa_l 
      \in SP_p(f, [y_{j-1}, y_j].
  \end{equation*} 
  So, 
  $x \in \overline{SP}_p(f, [y_{j-1}, y_j])$, 
  because $x \in \{t_i\}_{i=k}^l$.
  This contradicts (\ref{eq:notinST_p2}),
  thus, equality (\ref{eq:notinST_p7}) is not valid.
  As a result, inequality (\ref{eq:notinST_p6}) becomes
  \begin{equation}\label{eq:notinST_p9}
    v_p(f,[y_{j-1},y_j]) > v_p(f,[y_{j-1},t_{k}]) 
      + v_p(f,[t_{k},t_{l}]) + v_p(f,[t_{l},y_j]).
  \end{equation}    
  
  Since points $y_{j-1}$ and $y_j$ are $f$-joined,
  from the Lemma~\ref{lm:fjoin}(\ref{lm:fjoin_a}) we get
  \begin{equation*}\label{eq:notinST_p10}
    v_p(f,[y_{j-1},y_j]) = |f(y_{j-1})-f(y_j)|^p,
  \end{equation*}   
  therefore,
  \begin{equation*}\label{eq:notinST_p11}
    |f(y_{j-1})-f(y_j)|^p > v_p(f,[y_{j-1},t_{k}]) 
      + v_p(f,[t_{k},t_{l}]) + v_p(f,[t_{l},y_j]). 
  \end{equation*}        
  Moreover, according to 
  Lemma~\ref{lm:element_properties}(\ref{lm:ep_g}), 
  from the last statement follows
  \begin{equation} \label{eq:notinST_p12}
    |f(y_{j-1})-f(y_j)|^p > |f(y_{j-1})-f(t_{k})|^p +
       v_p(f,[t_k,t_l]) +  |f(t_{l})-f(y_j)|^p.   
  \end{equation}  
  
  Since $v_p(f)=v_p(-f)$ (see Proposition~\ref{prop:f_PM_g}), 
  with out loss of generality we can assume that
  $f(y_{j-1}) \geq f(y_j)$. 
  Hence, from the Lemma~\ref{lm:fjoin}(\ref{lm:fjoin_b}) 
  we get that
  \begin{eqnarray}
    f(y_{j-1}) \geq f(t_{l}) \geq f(y_j), \label{eq:notinST_13}  \\
    f(y_{j-1}) \geq f(t_{k}) \geq f(y_j). \label{eq:notinST_14}
  \end{eqnarray}  

  In addition, the pairs of points $\{t_l,t_{l+1}\}$ 
  and $\{t_{k-1},t_{k}\}$ are also $f$-joined, therefore,
  by the Lemma~\ref{lm:fjoin}(\ref{lm:fjoin_b})
  inequalities (\ref{eq:notinST_13}) and (\ref{eq:notinST_14})
  could be extended as
  \begin{eqnarray}
    \label{eq:notinST_15} 
    f(y_{j-1}) \geq f(t_{l}) \geq f(y_j) \geq f(t_{l+1}),  \\
    \label{eq:notinST_16}
    f(t_{k-1}) \geq f(y_{j-1}) \geq f(t_{k}) \geq f(y_j). 
  \end{eqnarray}         
    
  
  From the (\ref{eq:notinST_15}) the following inequalities holds
  \begin{eqnarray*}
    f(y_{j-1})-f(t_l) &\geq& 0, \\
    f(t_{l})-f(t_{l+1}) \geq f(t_l)-f(y_j) & \geq & 0.
  \end{eqnarray*} 
  Therefore, we can use Corollary~\ref{cor:convex}. According to it,
  from the inequality (\ref{eq:notinST_p12}) follows  
  \begin{eqnarray*}
    |f(y_{j-1})-f(t_l)+f(t_l)-f(y_j)|^p &>& |f(y_{j-1})-f(t_{k})|^p +
       v_p(f,[t_k,t_l]) +  |f(t_{l})-f(y_j)|^p, \\  
    |f(y_{j-1})-f(t_l)+f(t_l)-f(t_{l+1})|^p &>&|f(y_{j-1})-f(t_{k})|^p
      + v_p(f,[t_k,t_l]) +  |f(t_{l})-f(t_{l+1})|^p, \\
    |f(y_{j-1})-f(t_{l+1})|^p &>& |f(y_{j-1})-f(t_{k})|^p 
      + v_p(f,[t_k,t_l]) +  v_p(f,[t_l,t_{l+1}]). 
  \end{eqnarray*}    
  The last inequality holds,
  because points $t_{l}$ and $t_{l+1}$ are $f$-joined,
  thus, according to Lemma~\ref{lm:fjoin}(\ref{lm:fjoin_a}),
  \begin{equation*}\label{eq:notinST_17}
    v_p(f,[t_l,t_{l+1}]) = |f(t_{l})-f(t_{l+1})|^p.
  \end{equation*}   


  
  Symmetric argument could be used in other direction. 
  Firstly lets modify last inequality
  \begin{equation*}\label{eq:notinST_18}
    |f(y_{j-1})-f(t_k)+f(t_k)-f(t_{l+1})|^p > |f((y_{j-1})-f(t_{k})|^p 
      + v_p(f,[t_k,t_l]) +  v_p(f,[t_l,t_{l+1}]). 
  \end{equation*}   
  From the (\ref{eq:notinST_16}) we get that
   the following inequalities holds
  \begin{eqnarray*}
    f(t_k)-f(t_{l+1}) & \geq & 0, \\
    f(t_{k-1})-f(t_{k}) \geq f(y_{j-1})-f(t_k) & \geq & 0.
  \end{eqnarray*} 

  Thus, from Corollary~\ref{cor:convex} we get
  \begin{eqnarray*}
    |f(t_{k-1})-f(t_k)+f(t_k)-f(t_{l+1})|^p&>&
      |f(t_{k-1})-f(t_{k})|^p+v_p(f,[t_k,t_l])+v_p(f,[t_l,t_{l+1}]), \\
    |f(t_{k-1})-f(t_{l+1})|^p &>& v_p(f,[t_{k-1},t_{k}]) 
      + v_p(f,[t_k,t_l])+v_p(f,[t_l,t_{l+1}]).
  \end{eqnarray*}  
  As previous, the last inequality holds, 
  because $t_{k-1}$ and $t_{k}$ are
  $f$-joined.

  Finally, using Lemma~\ref{lm:pvarSubset} we conclude that
  $$|f(t_{k-1})-f(t_{l+1})|^p > v_p(f,[t_{k-1},t_{l+1}]).$$
  This contradicts with the definition of $p$-variation.    
  
  
\end{proof}

\subsection{Extra results}


\begin{definition}[Extremum]\label{def:extremum}
  We will call the point $t \in  [a,b]$ an \emph{extrema}
  of the function $f$ in interval $[a,b]$ if   
  $f(t)=\sup \left\{ f(z):z\in \left[ a,b\right]
  \right\} $ or 
  $f(t)=\inf \left\{ f(z):z\in \left[ a,b\right] \right\} $.
\end{definition}

%%% Global extremums are meaningful breaks %%% 
\begin{proposition}\label{prop:SplitMinMax}
  Let $f:[a,b] \rightarrow \mathbb{R}$ is $PM$. 
  If point $x \in [a,b]$ is extrema of the function $f$, 
  then $x \in \overline{SP}_p(f,[a, b])$.
\end{proposition}
\begin{proof}
  Let $f:[a,b] \rightarrow \mathbb{R}$ is $PM$ and
  point $x \in [a,b]$ is an extrema of the function $f$.
  Let $\{t_i\}_{i=0}^{n} \in SP_p(f,[a,b]$ 
  be any supreme partition. 
  Then
  \begin{equation}
    \exists j \in 1,\dots,n: x \in [t_{j-1},t_j] 
  \end{equation}  

  Since $x$ is an extrema of function $f$ in interval
  $[a, b] \supset [t_{j-1},t_j]$, 
  the point $x$ is an extrema in interval 
  $[t_{j-1}, t_j]$ as well. Therefore,
  \begin{equation}
    f(t_{j-1})-f(t_{j})|^p \leq |f(t_{j-1}) - f(x)|^p
  \end{equation}
  or
  \begin{equation}
    |f(t_{j-1})-f(t_{j})|^p \leq |f(x)-f(t_{j})|^p.
  \end{equation}
  As a result,
  \begin{eqnarray*}
  |f(t_{j-1})-f(t_{j})|^p 
    &\leq &|f(t_{j-1}) - f(x)|^p + |f(x) - f(t_{j})|^p,\\
  |f(t_{j-1}) - f(t_{j})|^p 
    &\leq & v_p(f, [t_{j-1}, x]) + v_p(f, [x, t_{j}]),\\
  v_p(f, [t_{j-1}, t_{j}])
    &\leq & v_p(f,[t_{j-1}), x]) + v_p(f,[x, t_{j}]).
  \end{eqnarray*}    
  The last inequality holds, because $t_{j-1}$ and  $t_{j}$
  are $f$-joined, so, 
  $v_p(f, [t_{j-1}, t_{j}])=|f(t_{j-1}) - f(t_{j})|^p$.
  Since $v_p(f, [t_{j-1}, t_{j}])
    < v_p(f,[t_{j-1}), x]) + v_p(f,[x, t_{j}])$
  is not valid, the equation
  \begin{equation}
    v_p(f, [t_{j-1}, t_{j}])
    = v_p(f,[t_{j-1}, x]) + v_p(f,[x, t_{j}])  
  \end{equation}
  holds.
  
  Moreover, applying Proposition~\ref{prop:pvar_sum_x} 
  for the partition
  $\{a, t_{j-1}, t_j, b \}$ we have 
   \begin{eqnarray*}
    v_p(f, [a, b]) &=& v_p(f,[a, t_{j}]) 
      + v_p(f,[t_{j-1}, t_{j}]) + v_p(f,[t_{j}, b]) \\
    &=& v_p(f,[a, t_{j}]) + v_p(f,[t_{j-1}, x]) 
      + v_p(f,[x, t_{j}]) + v_p(f,[t_{j}, b])
  \end{eqnarray*}
  From the same proposition follows, that
  $\exists \kappa \in SP_p(f, [a, b]):x\in\kappa$,
  so, by definition, $x \in \overline{SP}_p(f,[a, b])$.  
\end{proof}


\begin{lemma}\label{lm:evenkappa}
  Let $f:[a,b] \rightarrow \mathbb{R}$ be PM.
  If $K(f)$ is even, then
  \begin{equation}
    \exists x \in (a, b): x \in  \overline{SP}_p(f, [a, b]). 
  \end{equation}       
\end{lemma}
\begin{proof}
  Suppose $f:[a, b] \rightarrow \mathbb{R}$ is PM.
  Lets take any $\{x_i\}_{i=0}^n \in X(f)$.
  If $n>1$, then without loss of generality
  we can assume that Proposition~\ref{prop:PM_form}(a) 
  holds. So, $f(x_0)>f(x_1)<f(x_2)>\dots$, i.e.
  $f(x_{2i-1})<(x_{2i})$, thus,
  if $n$ is even, then $f(x_{n-1})<(x_{n})$,
  therefore, point $x_{n}$ is not a global minimum.
  Since $f(x_0)>f(x_1)$, point $x_0$ is also
  not a global minimum. As a result,
  global minimum is in interval $(a, b)$ 
  and it is in $\overline{SP}_p(f, [a, b])$ according to
  Lemma~\ref{prop:SplitMinMax}. 
\end{proof}


% Small increase
\begin{lemma}\label{lm:SI}
  Let $f:[a,b] \rightarrow \mathbb{R}$ be PM
  and $\{t_i\}_{i=0}^n \in PP[a, b]$.
  Suppose 
  \begin{equation}\label{eq:SI_1}
    \{t_i\}_{i=0}^{n-1} \in SP_p(f, [a, t_{n-1}]) 
  \end{equation} 
  and 
  \begin{equation}\label{eq:SI_2}
    \{t_i\}_{i=1}^{n} \in SP_p(f, [t_1, b]).
  \end{equation} 
  Then
  \begin{equation}\label{eq:SI_3}
    \forall i \in \{1,\dots,n-1\}: t_i \in \overline{SP}_p(f, [a, b])
  \end{equation} 
  or
  \begin{equation}\label{eq:SI_4}
    \forall i \in \{1,\dots,n-1\}: t_i \notin \overline{SP}_p(f, [a, b])
  \end{equation}   
\end{lemma}
\begin{proof}
  Let the assumptions of lemma be valid. 
  Firstly, suppose 
  \begin{equation}\label{eq:SI_p1}
    \exists j \in \{1,\dots,n-1\}: t_j \in \overline{SP}_p(f, [a, b]).
  \end{equation}
  This means that 
  $\exists \kappa \in SP_p(f, [a, b]): t_j \in \kappa$.
  Then, by Proposition~\ref{prop:pvar_sum_x},
  \begin{equation}
    v_p(f, [a, b]) = v_p(f, [a, t_j]) + v_p(f, [t_j, b])
  \end{equation}
  
  Since (\ref{eq:SI_1}) and (\ref{eq:SI_1}) holds, 
  by Lemma~\ref{lm:spSubset} we get 
  \begin{eqnarray}
    v_p(f, [a, t_j]) = s_p(f, \{t_i\}_{i=0}^j, \\
    v_p(f, [t_j, b]) = s_p(f, \{t_i\}_{i=j}^n.
  \end{eqnarray}
  
  Therefore,
  \begin{equation}
    v_p(f, [a, b]) = s_p(f, \{t_i\}_{i=0}^j) +  s_p(f, \{t_i\}_{i=j}^n)
      = s_p(f, \{t_i\}_{i=0}^n).
  \end{equation}  
  
  So, $\{t_i\}_{i=0}^n \in SP_p(f, [a, b])$, 
  thus, statement (\ref{eq:SI_3}) holds.
  
  On the other hand, if (\ref{eq:SI_p1}) is not valid, 
  then statement (\ref{eq:SI_4}) holds.  
  
\end{proof}



\section{p-variation calculus}  
\label{sec:pvarcalc}  
  
In this chapter we will present the algorithm that calculates 
$p$-variation for the sample (see Def.~\ref{def:pvarseq}). 
Nonetheless, this algorithm could be used to calculate
the $p$-variation for arbitrary piecewise monotone function. 
This procedure will be called \emph{pvar}. 
It is already realised in the R (see~\cite{R}) package \emph{pvar} and
is publicly available on CRAN\footnotemark.
\footnotetext{
http://cran.r-project.org/web/packages/pvar/index.html
}

Firstly, we will give some introductory notes about the
procedure. Later on, the main schema of the
algorithm will be presented in the
Subsection~\ref{sub:MainFunction}. And finally, 
each step of the algorithm are disused in more details in 
Subsection~\ref{sec:DetailExplanation}.

\subsection{Introductory notes}


Suppose $X=\{X_{i}\}_{i=0}^{n}$ is any real-value sequence of numbers. 
We will call such sequence a \emph{sample}, 
whereas $n$ will be referred to as a \emph{sample size}.
The formal definition of $p$-variation 
of the sample is given in Definition~\ref{def:pvarseq}, 
which states that
\begin{equation}
  v_p(X) = v_p(G_X(t),[0,n]),
\end{equation}
where $G_X(t)$ is a sample function defined in  
Definition~\ref{def:Seq2Fun}.
On the other hand, 
$p$-variation of the sample could express as
\begin{equation}
  v_p(X) = \max\left\{ \sum_{i=1}^k |X_{j_i} - X_{j_{i-1}}|^p :
  0=j_0<\dots<j_k=n,\; k=1,\dots,n  \right\}.
\end{equation}
This expression could be verified from
Proposition~\ref{prop:sup_in_PM},
which states, that $p$-variation
is achieved in a subset of any partition $r \in X(f, [0,n])$.
So, we can construct $r$ from the subset $\{0, 1, \dots, n\}$. 
If $j \in \{0, 1, \dots, n\}$ then $G_X(j) = X_j$, thus,
$G_X(j)$ could be replaced with $X_j$. As a result,
we don't need to use $G_X(j)$ function, rather, 
the values of the sample $X_j$ could be used directly. 
This is the way algorithm works --
it actually operates the the values of the sample $X$,
not involving $G_X(t)$ function. Nonetheless,
then we will refer to properties of $p$-variation
we actually have in mind function $G_X(t)$, since all
the properties of $p$-variation are formulated for functions.

The members of the sample $X$ that are in supreme partition are
called \emph{supreme points}. All the members
that are not in supreme partition refereed as
\emph{redundant} points. 
Those points could be removed from original sample without any effect to 
the value of $p$-variation.

The main idea of the algorithm is to find the supreme
partition, by identifying and dropping all the redundant
points, i.e. the points that are not in supreme partition.
For this purpose, the most important property is
stated in the Proposition~\ref{prop:notinST},
which allows us to investigate possible 
partition by analysing not the whole sample, but
smaller sub-samples of $X$. From the
Proposition~\ref{prop:notinST} follows, that 
if a point was identify as being redundant in any
small interval, then the point is redundant in
any larger interval. 

Suppose $j \in \{0, 1, \dots, n\}$ and
$j \notin SP_p(G_X, [0, n])$. This means that
$j$ is not in supreme partition. Therefore, 
sample member $X_j$ is redundant and should be excluded from further consideration.
Removing $X_j$ means that we 
updating sample $X$ with new sample $X'$ which do not have
$X_j$ element, namely,  
$$
\{X'_{i}\}_{i=0}^{n-1}:=\{X_0,\dots,X_{j-1},X_{j+1},\dots,X_n\}.
$$
And in further analysis we investigate the sample $X'$. 

It is worth noting, 
that the procedure \emph{pvar} could be used to calculate
the $p$-variation of any piecewise monotone function.
Let assume $f$ is any piecewise monotone function.  
According to definition (see~\ref{def:PM}) 
there are points $a=x_1<\dots<x_n=b$ for some finite $n$ such 
that $f$ is monotone on each interval 
$[x_{j-1},x_j],\;j=1,2,\dots,n$.
We can calculate $p$-variation if we have the sample $X$, 
which contains the values of the function $f$ 
at the points $\{x_{i}\}_{i=0}^{n}$, namely,
$X=\{X_{i}\}_{i=0}^{n}:=\{f(x_{i})\}_{i=0}^{n}$.
It is straight forward to see that 
$f \stackrel{PM}{=} G_X$, 
therefore, if $p \geq 1$, then $v_p(X)=v_p(G_X)=v_p(f)$.


\subsection{Main function}
\label{sub:MainFunction}

The procedure \emph{pvar} that calculates
$p$-variation will be presented here. This procedure
is already available in R package \emph{pvar}. Firstly,
we will introduce the main schema, further, each step will
be discussed in more details. 
The main steps in \emph{pvar} procedure
goes as follows.


\paragraph{Procedure \emph{pvar}.}
Input: sample $X$, scalar $p$.

\begin{enumerate}
  \item \emph{Removing monotonic points}. According to 
  Proposition~\ref{prop:sup_in_PM}
  all points that are not the end of 
  monotonic interval could be excluded 
  from further consideration. 
  
  \item \emph{Checking all small intervals}. Every small intervals are
    checked if it is possible to 
    identify insignificant points. 
    This operation is based on 
    Proposition~\ref{prop:notinST} which states that 
    If $x \notin \overline{SP}_p(f, [a', b'])$, then 
    $x \notin \overline{SP}_p(f, [a, b])$.
    So, if $X_j$ appears to be insignificant in
    any small sub-sample, then
    we do not need to consider possibility for
    $X_j$ to be in supreme sample any more. 
    More details are given in section~\ref{sec:CheckSmallIntervals}.  
 
  \item \emph{Merging small intervals}.  
   Let $\kappa_{a,c} \in SP_p(G_X, [a,c])$ and
   $\kappa_{c,b} \in SP_p(G_X, [c, b])$. By using $\kappa_{a,c}$
   ans $\kappa_{c,b}$, we can effectively
   find $\kappa_{a,b} \in SP_p(G_X, [a, b])$, since
   $\kappa_{a,b} \subset \kappa_{a,c} \cup \kappa_{c,b}$. 
   Finding
   $\kappa_{a,b}$ from $\kappa_{a,c}$ and $\kappa_{c,b}$ 
   is called \emph{merging}.
   In this step we repeat merging of all small intervals until
   we get the finial supreme partition.
   The whole procedure is described in section~\ref{sec:meging}.  
  
\end{enumerate}



The corresponding psiaudocode of the main function goes as follows



\begin{algorithm}[H]
\caption{The main function of \emph{pvar} procedure that calculates $p$-variation of the sample.}\label{alg:pvarmain}
\begin{algorithmic}[1]
\Function{pvar}{sample $X$, scalar $p$}

\Comment{update $X$ by removing monotonic points}
\State $X \leftarrow sampleCorners(X)$;

\Comment{update $X$ by checking all sub-intervals and removing redundant points.}
\Comment{check sub-intervals up to the length of 3} 
\State $LSI \leftarrow 3$ ;
\State $X \leftarrow $ CheckSmallIntervals ($X$,  $p$, $LSI$);

\Comment{update $X$ by merge all sub-intervals starting with the length of $LSI+1$}
\State $X \leftarrow$ merging ($X$,  $p$, $LSI+1$);

\Comment{calculate the $p$-variation:}
\State value $\leftarrow \sum |X_{i-1}-X_i |^p $ ; 

\State \textbf{return} value;
\EndFunction
\end{algorithmic}
\end{algorithm}


%\begin{algorithm}[H]
%  \Input{array $X$ (the sample), constant $p$ (the $p$ value)}
%  \Output{constant $\pval$ (the value of $p$-variation),\\
%   modified array $X$ that contains only supreme points}
%  \Begin{
%    \tcc{Update $X$ by removing monotonic points form $X$:}
%    $\ChangeIds \leftarrow$ \ChangePoints {$X$} \;
%    $X \leftarrow X[ChangeIds]$ \;
%    
%    \tcc{Update $X$ by checking all sub-intervals with the length of $LSI=3$ and removing redundant points:}
%    $LSI \leftarrow 3$ \;
%    $X \leftarrow $ \CheckSmallIntervals{$X$,  $p$, $LSI$}\;
%
%    \tcc{update $X$ by merge all sub-intervals starting with the length of $LSI+1$: }
%    $X \leftarrow $ \merging{$X$,  $p$, $LSI+1$}\;
%
%    \tcc{calculate the $p$-variation:}
%    $\pval \leftarrow \sum |X_{i-1}-X_i |^p $ \;    
%  }
%  \caption{The main function of pvar procedure.}
%\end{algorithm}


  
\subsection{Detail explanation}
\label{sec:DetailExplanation}

\subsubsection{Removing monotonic points}

According to Proposition~\ref{prop:sup_in_PM}
the $p$-variation is achieved 
on the partition of monotonic intervals.
Therefore the points that are not 
the end of monotonic interval are redundant 
and should be drop out.
The points that are the end of monotonic intervals
will be referred as \emph{corners}. 
In a single loop we can 
find all the corners by checking if the sequence
changed the direction form increasing to decreasing
(or vice versa). In addition, points $X[0]$ and $X[n]$
always included in the array of corners by definition.
The corresponding pseudo code looks as follows:


\begin{algorithm}[H]
\caption{The function \emph{SampleCorners} that
returns the subset of $X$, which contains only the corners of $X$.}
\label{alg:SampleCorners}
\begin{algorithmic}[1]
\Function{SampleCorners}{sample $X$}
\Output sample $corners$ that is the subset of $X$, which contains only the corners

\State $corners \leftarrow X_0$;
\State $direction \leftarrow 0$;
\State $n \leftarrow counter(X)$;
\For{$i \leftarrow 1$ \textbf{ to } $n-1$}
  \If {$X_{i-1} < X_{i}$}
    \If {$direction < 0$}
      \State $corners \leftarrow append(corners, X_{i-1})$;
    \EndIf
    \State $direction \leftarrow 1$ ;
  \EndIf
  \If {$X_{i-1} > X_{i}$}
    \If {$direction > 0$}
      \State $corners \leftarrow append(corners, X_{i-1})$;
    \EndIf
    \State $direction \leftarrow -1$ ;
  \EndIf   
\EndFor
\State $corners \leftarrow append(corners, X_{n})$; 
\State \textbf{return} corners;
\EndFunction
\end{algorithmic}
\end{algorithm}


%\begin{algorithm}[H]
%  \SetKwData{corners}{corners}
%  \SetKwData{direction}{direction}
%  \SetKwFunction{append}{append}
%  \SetKwInOut{Input}{input}\SetKwInOut{Output}{output}
%
%  \Input{sample $X$}
%  \Output{sample $\corners$}
%  \Begin{
%    $\corners \leftarrow X[0]$ \;
%    $\direction \leftarrow 0$ \;
%    \For{$i \leftarrow 1$ \KwTo $n-1$}{
%      \If{$X[i-1] < X[i]$}{
%        \If{$\direction<0$}{
%          $\corners \leftarrow \append(\corners, X[i-1])$
%        }
%        $\direction \leftarrow 1$ \;
%      }    
%      \If{$X[i-1] > X[i]$}{
%        \If{$\direction>0$}{
%          $\corners \leftarrow \append(\corners, X[i-1])$
%        }
%        $\direction \leftarrow -1$ \;
%      }   
%    }
%    $\corners \leftarrow \append(\corners, X[n])$
%  }
%  \caption{Procedure ... \emph{ChanegePoints} ... }
%\end{algorithm}


This procedure is quite simple and
 can by performed very quickly, since it does not include
any cross checking and could be done in one loop.
In \emph{pvar} package all corners could be found with \emph{ChangePoints} function.



\subsubsection{Checking all small intervals}
\label{sec:CheckSmallIntervals}

Proposition~\ref{prop:pvar_sum_x} and 
Lemmas~\ref{lm:SI} and~\ref{lm:evenkappa} gives an effective 
way to identify significant part of 
redundant points 
using quite simple operations. 
The pseudo code is given in the end the chapter and
now we will reviled it main principles.

Suppose $X$ is a sample without monotonic points. 
Let investigate a sub-sample in
any small interval of the length $m$ ($m=2,\dots,n-1$), 
namely, lets examine a sub-sample 
$\{X_{i}\}_{i=j}^{j+m}$
for any $j=0,...,n-m$.
According to Proposition~\ref{prop:pvar_sum_x},
If 
\begin{equation}\label{eq:dropsamll1}
  \sum_{i=j+1}^{j+m} |X_{i}-X_{i-1}|^p < |X_j-X_{j+m}|^p,
\end{equation}
then,
partition $\{j,\dots,j+m\}$ 
can not be supreme partition in interval
$[j,j+m]$. 
Therefore, some of the points $\{X_{i}\}_{i=j+1}^{j+m-1}$
must be redundant.
Moreover, Lemmas~\ref{lm:SI} and~\ref{lm:evenkappa} 
gives opportunity easily identify 
insignificant points. To do so, we must 
systemically investigate small intervals starting form
small $m$.

\begin{itemize}

\item 
Let $m=2$. Then $|\{X_{i}\}_{i=j}^{j+2}|=2$, thus according to
Lemma~\ref{lm:evenkappa}, $\{X_{i}\}_{i=j}^{j+2}$ has at least one
inner significant point. 
Since it has only one inner point $X_{j+1}$, then 
this point must be significant. 
So, if $m=2$, then  (\ref{eq:dropsamll1}) is always invalid,
therefore, we don't need to do any checking.

\item 
Let $m=3$. Firstly, we need to check if (\ref{eq:dropsamll1}) holds.
If so,
then at least one 
point must be redundant.
In addition, Lemma~\ref{lm:SI} ensures that in this case
both middle points $X_{t+1}$, $X_{t+2}$ 
are redundant, therefore, they both should be removed. 

We do this checking for  for all
$j=0,...,n-2$. In this way
we can identify quite an amount of redundant
points. Moreover, after removing them from the sample the 
sample changes, so we can repeat the same procedure
and find more redundant points. We do it until
no new redundant points are 
identified.

\item 
If $m=4$, then $|\{X_{i}\}_{i=j}^{j+2}|$ is even, 
thus, according to Lemma~\ref{lm:evenkappa}, 
$\{X_{i}\}_{i=j}^{j+m}$ has at least one
inner significant point. So, all inner points are significant, 
based on Lemma~\ref{lm:SI}, therefore, 
(\ref{eq:dropsamll1}) do not hold.
Lemma~\ref{lm:evenkappa} ensure
that this argument holds in all cases, then $m$ is even.
So, actually we need to investigate only the cases, then 
$m$ is odd. 

\item 
Let 
$m=5$ and all sub-samples
 $\{X_{i}\}_{i=j}^{j+3},\;j=0,...,n-3$ are already 
 checked.
If (\ref{eq:dropsamll1}) holds, then, based on
Lemma~\ref{lm:SI}, all middle points
$X_{t+1}$, $X_{t+2}$, $X_{t+3}$  and $X_{t+4}$ are  
identified as redundant and should be removed.
After removing points, the sample changes, thus,
if we want to apply this checking again,
then we should start checking from $m=3$ again, because
we must make sure that all sub-samples
$\{X_{i}\}_{i=j}^{j+3},\;j=0,...,n-3$ are already 
checked, because this is a requirement of the Lemma \ref{lm:SI}.

\item If we want to go further and check
sub-samples for $m=7,9,11\dots$, every time we have to
start from $m=3$ and increase $m$ by $2$ only then
(\ref{eq:dropsamll1}) is not valid for
all sub-samples.

\end{itemize}

We can continue this checking until $m$ 
reaches an arbitrary threshold $M$.
The  pseudo-code  of this procedure is given below

\begin{algorithm}[H]
\caption{Procedure \emph{CheckSmallIntevals}, which ensures 
that any sequantal sub-sample of length $M$ is a supreme partition in corresponding sub-interval.}
\label{alg:CheckSmallIntevals}
\begin{algorithmic}[1]
\Function{CheckSmallIntevals}{
  sample $X$, 
  constant $p$, 
  constant $M$}
\Require sample $X$ must contain only the corners (i.e. no monotonic points)
\Output modified sample $X$ such that any sequential sub-sample of length $M$ is a supreme partition in corresponding sub-interval
\item[]
\State $tempX \leftarrow NULL$ ;
\State $m \leftarrow 0$ ;
\While{$tempX \neq X$ {\bf and } $m < M$}
  \State $tempX \leftarrow X$ ;
  \State $m \leftarrow 3$ ;
  \State check all sub-samples of $X$ with length $m$ ;
  \State update $X$ by dropping all redundant points ;  
  \While{$tempX \neq X$ {\bf and } $m < M$}
    \State $m \leftarrow m + 2$ ;
    \State check all sub-samples of $X$ with length $m$ ;
    \State update $X$ by dropping all redundant points ; 
  \EndWhile
\EndWhile
\State \textbf{return} $X$;
\EndFunction
\end{algorithmic}
\end{algorithm}



%\begin{algorithm}[H]
%  \SetKwData{tempX}{tempX}
%  \SetKwData{NULL}{NULL}
%  \SetKwInOut{Input}{input}\SetKwInOut{Output}{output}
%
%  \Input{sample $X$, constant $p$, constant $M$}
%  \Output{modified sample $X$}
%  \Begin{
%    \nl$\tempX \leftarrow \NULL$ \;
%    $m \leftarrow 0$ \;
%    
%    \While{$\tempX \neq X$ {\bf and} $m < M$}{
%      $\tempX \leftarrow \tempX$ \;
%      $m \leftarrow 3$ \;
%      check all sub-samples of $X$ with length $m$ \;
%      update $X$ by dropping all redundant points \;  
%      \While{$\tempX \neq X$ {\bf and} $m < M$}{
%        $m \leftarrow m + 2$ \;
%        check all sub-samples of $X$ with length $m$ \;
%        update $X$ by dropping all redundant points \;       
%      }
%    }    
%  }
%  \caption{Procedure ... check small intervals ... }
%\end{algorithm}



With this procedure, we can actually find 
$p$-variation, setting $M$ to sufficiently large value.
But this way of finding $p$-variation is not effective, 
because in case of any removing 
we should go back and start checking
from $m=3$.
So, it is reasonable to use this procedure
only for small $m$ and then go
to next step of $p$-variation calculus.


% From Monte-Carlo experiment we made
% a recommendation that $m$ sho



\subsubsection{Merging small intervals}
\label{sec:meging}

Suppose it is already known that 
a sub-samples $\{X_{i}\}_{i=a}^{w}$  and $\{X_{i}\}_{i=w}^{b}$
are a supreme partitions in intervals $[a,w]$ and $[w,b]$ correspondingly. 
The \emph{merge} operation of intervals $[a,w]$ and $[w,b]$ is
an operation that finds supreme partition 
of the interval $[a,b]$ taking into account
that  $\{X_{i}\}_{i=a}^{w}$  and $\{X_{i}\}_{i=w}^{b}$
are a supreme partitions.

The final procedure in $p$-variation calculus will be
presented in this subsection. It is based on
merging operation.
All the small intervals which where already checked in the 
previous procedure are merged one by one until all the
possible combinations are checked and we end up having
the supreme partition and $p$-variation.

This procedure has two stages that will be discussed separately.

\paragraph{Merge two intervals}

This paragraph will present how two intervals are merged .
Suppose $\{X_{i}\}_{i=a}^{w}$  and $\{X_{i}\}_{i=w}^{b}$
are a supreme partitions in intervals $[a,w]$ and $[w,b]$ correspondingly. 
According to Proposition~\ref{prop:notinST},
the supreme partition in interval $[a, b]$ must
be a subset of 
$\{X_{i}\}_{i=a}^{b} = \{X_{i}\}_{i=a}^{w} \cup \{X_{i}\}_{i=w}^{b}$.
 
In order to find supreme partition in interval $[a,b]$
we need to investigate all possible
$f$-joints (Def.~\ref{def:fjoin}) between points $X_t, t\in \{a,\dots,w-1\}$ and
$X_r, r\in \{w,\dots,b\}$ and choose pair of points
$(t, r)$ which maximise $s_p$ function, namely  
\begin{eqnarray}
  (t, r) &:=& \argmax_{(i,j) \in [a, w-1] \times [w, b] } 
    \left\{ \sum_{k=a+1}^i |X_{k-1} + X_{k}|^p + |X_i-X_j|^p 
    + \sum_{k=j+1}^b |X_{k-1} + X_{k}|^p \right\}, \nonumber \\
  &=& \argmax_{(i,j) \in [a, w-1] \times [w, b] }  
    \left\{|X_i-X_j|^p +  \sum_{k=a+1}^b |X_{k-1} + X_{k}|^p  
    - \sum_{l=i+1}^j |X_{l-1} + X_{l}|^p  \right\}, \nonumber \\
   \label{eq:tr_argmax}  
   &=& \argmax_{(i,j) \in [a, w-1] \times [w, b] }  
    \left\{|X_i-X_j|^p - \sum_{l=i+1}^j |X_{l-1} + X_{l}|^p  \right\},   
\end{eqnarray}

In the special case then $t=w-1$ and $r=w$, the value 
of function in $\argmax$ is zero and the supreme
partition is $\{X_{i}\}_{i=a}^{b}$. So, in this case we do not 
need to do any modifications of the sample. 
This case is taken as baseline and we consider 
any modifications only then the value of function
in $\argmax$ is greater then zero.

In addition, the calculation of $(t, r)$ in (\ref{eq:tr_argmax})
could be optimised, since we actually do not need to check
all $(i,j) \in [a, v-1] \times [v+1, b]$. 
Based on Lemma~\ref{lm:fjoin},
points $X_t$ and $X_r$ could be $f$-joined only if 
\begin{equation}
  \forall i \in \{t,\dots,r\}: X_t \geq X_i \geq X_r \text{ or } 
  X_t \leq X_i \leq X_r.
\end{equation} 
   
And the last statement holds only if 
\begin{equation}\label{eq:setT}
  X_t =  \min ( X_i : i \in \{t, \dots, w\}) 
    \text{ or } X_t =  \max ( X_i : i \in \{t, \dots, w\})
\end{equation}
and
\begin{equation}\label{eq:setR}
  X_r =  \min ( X_i : i \in \{w, \dots, r\}) 
    \text{ or } X_r = \max ( X_i : i \in \{w, \dots, r\}).
\end{equation} 


Let $T$ denotes a set of $i \in \{a,\dots ,w-1\}$ which satisfy 
(\ref{eq:setT}) and $R$ denotes a set of 
$j \in \{w+1,\dots ,b\}$ which satisfy (\ref{eq:setR}).
Then (\ref{eq:tr_argmax}) 
could be expressed as
\begin{equation}
  (t, r) :=  
    \argmax_{(i,j) \in T \times R }  
    \left\{|X_i-X_j|^p - \sum_{l=i+1}^j |X_{l-1} + X_{l}|^p  \right\}.   
\end{equation} 

Since points $X_t$ and $X_r$ are $f$-joint, all the 
points in interval $t+1,\dots, r-1$ are redundant
and should be removed. And the remaining points are supreme partition.


\begin{algorithm}[H]
\caption{Procedure \emph{MergeTwoInt}, which merges two
intervals represented by their supreme samples. }
\label{alg:MergeTwoInt}
\begin{algorithmic}[1]
\Function{MergeTwoInt}{
  sample $A$, 
  sample $B$, 
  scalar $p$}
\Require samples $A$ and $B$ must be supreme partitions in
intervals $[a,c]$ and $[c,b]$ correspondingly.
\Output sample $X$, which is the supreme partition of interval $[a,b]$
\item[]

\State $X \leftarrow A \cup  B$ ;   
\State $a \leftarrow 0$ ;     
\State $b \leftarrow counter(X)$ ;
\State $w \leftarrow counter(A)$ ;
\item[]
\item[] \Comment Find the T list:
\State initiate $T$ as empty list ;
\State $cummax \leftarrow cummin \leftarrow X_w$ ;
\For{$i \leftarrow w-1$ \textbf{ to } $a$}
  \If{$X_i > cummax$}
    \State $cummax \leftarrow X_i$ ;
    \State $T \leftarrow append(T, i)$
  \EndIf
  \If{$X_i < cummin$}
    \State $cummin \leftarrow X_i$ ;
	\State $T \leftarrow append(T, i)$ ;
  \EndIf   
\EndFor
\item[]
\item[] \Comment Find the R list:
\State initiate $R$ as empty list ;
\State $cummax \leftarrow cummin \leftarrow X_w$ ;
\For{$i \leftarrow w+1$ \textbf{ to } $b$}
  \If{$X_i > cummax$}
    \State $cummax \leftarrow X_i$ ;
    \State $R \leftarrow append(R, i)$
  \EndIf
  \If{$X_i < cummin$}
    \State $cummin \leftarrow X_i$ ;
	\State $R \leftarrow append(R, i)$ ;
  \EndIf   
\EndFor
\algstore{myalg}
\end{algorithmic}
\end{algorithm}


\begin{algorithm}[H]                     
\begin{algorithmic} [1]                
\algrestore{myalg}

\item[] \Comment Check all pairs in T x R:
\State $maxbalance \leftarrow 0$ ; 
\For{$r \in R$}
  \For{$t \in T$}
    \State $balance \leftarrow |x_t - X_r|^p - \sum_{i=t+1}^r |X_{i-1}-X_i|^p$ ;
      \If{$balance > maxbalance$}
      	\State $maxR \leftarrow r$ ;
        \State $maxT \leftarrow t$ ;
        \State $maxbalance \leftarrow balance$ ;
      \EndIf
  \EndFor      
\EndFor
\If{$maxbalance > 0$}
  \State remove points $t+1, \dots, r-1$ from sample $X$ ;
\EndIf


\State \textbf{return} $X$;
\EndFunction
\end{algorithmic}
\end{algorithm}


%\begin{algorithm}[H]
%  \SetKwData{cummax}{cummax}
%  \SetKwData{cummin}{cummin}
%  \SetKwData{maxR}{maxR}
%  \SetKwData{maxT}{maxT}
%  \SetKwData{maxbalance}{maxbalance}
%  \SetKwData{balance}{balance}
%  \SetKwFunction{counter}{counter}
%  \SetKwFunction{append}{append}
%  \SetKwInOut{Input}{input}\SetKwInOut{Output}{output}
%
%  \Input{sample $A$, which is the supreme partition of interval $[a,c]$;\\
%    sample $B$, which is the supreme partition of interval $[c,b]$ }
%  \Output{sample $X$, which is the supreme partition of interval $[a,b]$}
%  \BlankLine  
%  \Begin{
%    $X \leftarrow A \cup  B$ \;   
%    
%    $a \leftarrow 0$ \;
%    $b \leftarrow \counter(X)$ \;
%    $w \leftarrow \counter(A)$ \;
%      
%
%    \tcc{Find the T list:}
%    initiate $T$ as empty list \;
%    $\cummax \leftarrow \cummin \leftarrow X_w$ \;
%    \For{$i \leftarrow w-1$ \KwTo $a$}{
%      \If{$X_i > \cummax$}{
%         $\cummax = X_i$ \;
%         $T \leftarrow \append(T, i)$ \;
%      }
%      \If{$X_i < \cummin$}{
%         $\cummin = X_i$ \;
%         $T \leftarrow \append(T, i)$ \;
%      }
%    }
%
%	\tcc{Find the R list:}
%    initiate $R$ as empty list \;
%    $\cummax \leftarrow \cummin \leftarrow X_w$ \;
%    \For{$i \leftarrow w+1$ \KwTo $b$}{
%      \If{$X_i > \cummax$}{
%         $\cummax = X_i$ \;
%         $R \leftarrow \append(R, i)$ \;
%      }
%      \If{$X_i < \cummin$}{
%         $\cummin = X_i$ \;
%         $R \leftarrow \append(R, i)$ \;
%      }
%    }  
%    
%    \tcc{Check all pairs in T x R:}
%    $\maxbalance \leftarrow 0$ \; 
%    \For{$r \in R$}{
%      \For{$t \in T$}{
%        $\balance = |x_t - X_r|^p - \sum_{i=t+1}^r |X_{i-1}-X_i|^p$\;
%        \If{$\balance > \maxbalance$}{
%      	  $\maxR = r$\;
%          $\maxT = t$\;
%          $\maxbalance = \balance$ \;
%        }        
%      }
%    }  
%      
%    \If{$\maxbalance >0$}{
%      remove points $t+1, \dots, r-1$ from sample $X$.
%    }
%    
%    
%  }
%  \caption{Procedure \emph{MergePair}, which merges a pair of samples that represents supreme partitions of  sequential samples. }
%\end{algorithm}


\paragraph{Merging all small intervals.}
In the second stage of this procedure we get the final result by
merging intervals pair by pair until the supreme partition of the whole sample is obtain.

The pseudo code is given below and its illustration is given in Figure~\ref{fig:Merging2}.

\begin{algorithm}[H]
\caption{Procedure \emph{MergeAll}, which merges all
sub-intervals of the length $M$ into final supreme sample}
\label{alg:MergeAll}
\begin{algorithmic}[1]
\Function{MergeAll}{
  sample $X$, 
  scalar $p$, 
  scalar $M$}
\Require sample $X$... of $M$ ...
\Output sample $S$ that corresponds to supreme portion.
\item[]
\item[]
\Comment Get array $prt = \{prt_i\}_{i=1}^n$ of supreme sub-intervals
\For{$i \leftarrow 1$ \textbf{ to } $\lc counter(X)/M \rc$}
  \State $prt_i \leftarrow 
    \left\{ X_j \right\}_{j=M(i-1)}^{\min(Mi, counter(X))}$ ;
\EndFor
\item[]
\item[] \Comment Apply pair merging to elements of $prt$ until all intervals are merged

\While{$counter(prt)>1$}
\State $i \leftarrow 1$ ;
  \While{$i < counter(prt)$}
    \State $prt_i \leftarrow mergeTwoInt(prt_i, prt_{i+1}) $ ;
    \State $i \leftarrow i+2$ ;  
  \EndWhile
  delete all elements form $prt$ that have even index ;
\EndWhile
\State $S \leftarrow prt_1 $ ;

\State \textbf{return} $S$;
\EndFunction
\end{algorithmic}
\end{algorithm}

%\begin{algorithm}[H]
%  \SetKwData{prt}{prt}
%  \SetKwFunction{counter}{counter}
%  \SetKwFunction{mergeTwoInt}{mergeTwoInt}
%  \SetKwInOut{Input}{input}\SetKwInOut{Output}{output}
%
%  \Input{sample $X$, which all sub-interval are supreme partitions;\\
%    constant $M$, the length of sub-intervals
%  }
%  \Output{sample $S$ which is a supreme partition in $[a, b]$}
%  \Begin{
%  
%    \tcc{Get array $\prt = \{prt_i\}_{i=1}^n$ of supreme partitions}
%    \For{$i \leftarrow 1$ \KwTo $\lc counter(X)/M \rc$}{
%      $\prt_i \leftarrow 
%        \left\{ X_j \right\}_{j=M(i-1)}^{\min(Mi, counter(X))}$ \;
%    }
%  
%  
%    \tcc{Apply pair merging to elements of $\prt$ until all intervals are merged}   
%    \While{$\counter(\prt)>1$}{
%      $i \leftarrow 1$ \;
%      \While{$i < \counter(\prt)$}{
%        $\prt_i \leftarrow \mergeTwoInt(\prt_i, \prt_{i+1}) $ \;
%        $i \leftarrow i+2$ \;  
%      }
%      delete all elements form $\prt$ that have even index\;
%    }   
%    $S \leftarrow \prt_1 $ \; 
%  }
%  \caption{Procedure ... check small intervals ... }
%\end{algorithm}

  
  
% Define block styles
\tikzstyle{block} = [rectangle, draw, fill=blue!20, 
    text width=5em, text centered, rounded corners, minimum height=4em]
\tikzstyle{line} = [thick,->,>=stealth] % [thick,->,>=stealth]  % [draw, -latex']  
  
\begin{figure}
\centering  
\begin{tikzpicture}[node distance = 2.5cm, auto]  
  \node [block] (el11) {el 1,1 $\sum$ };
  \node (AuxNode11) [right of=el11, node distance = 1.5cm] {};
  \node [block, right of=el11, node distance=3cm] (el12) {el 1,2 };
  \node (AuxNode12) [right of=el12, node distance = 1.5cm] {};
  \node [block, right of=el12, node distance=3cm] (el13) {el 1,3 };
  \node (AuxNode13) [right of=el13, node distance = 1.5cm] {};
  \node [block, right of=el13, node distance=3cm] (el14) {el 1,4 };
  \node [block, right of=el14, node distance=3cm] (el15) {el 1,5 };

  \node (AuxNode21) [below of=AuxNode12] {};
  \node [block, below of=AuxNode11] (el21) {el 21 };
  \node [block, below of=AuxNode13] (el22) {el 22 };
  \node [block, below of=el15] (el23) {el 23};  
  
  \node [block, below of=AuxNode21] (el31) {el 31 };
  \node (AuxNode31) [right of=el31, node distance = 4.2cm] {};
  \node [block, below of=el23] (el32) {el 32};  
  
  \node [block, below of=AuxNode31] (el41) {el 41};  
  
  %% arrows  
  \draw [line] (el11) -- (el21);
  \draw [line] (el12) -- (el21);  
  \draw [line] (el13) -- (el22);
  \draw [line] (el14) -- (el22);   
  \draw [line] (el15) -- (el23);   
  
  \draw [line] (el21) -- (el31);  
  \draw [line] (el22) -- (el31);  
  \draw [line] (el23) -- (el32);  
  
  \draw [line] (el31) -- (el41);  
  \draw [line] (el32) -- (el41);  
\end{tikzpicture}  
\caption{The illustration of the final stage of merging procedure.}
\label{fig:Merging2}
\end{figure}

  
\section{Conclusion}  
  
In this article we presented the algorithm that calculates
$p$-variations of the sample. 
This algorithm is based on mathematical properties that 
were formulated and proved in the article.
 
  
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\begin{thebibliography}{99}  

% Black–Scholes–Merton akcijų kainų modelis
\bibitem{Econ1997}
J.~Y.~Campbell, A.~W. Lo, A. Craig Mac Kinlay. The
Econometrics of Financial Markets, Princeton University Press, 
ISBN~0-691-04301-9, 1997.

% rimta santrauka 1
\bibitem{DudleyNorvaisa1998} 
R. M. Dudley, R. Norvai\v{s}a. An Introduction to
$p$-variation and Young Integrals, Cambridge, Mass., 1998.

% rimta santrauka 2
\bibitem{DudleyNorvaisa1999} 
R. M. Dudley, R. Norvai\v{s}a. Differentiability of 
Six Operators on Nonsmooth Functions and $p$-variation, 
Springer Berlin Heidelberg, 
Print ISBN 978-3-540-65975-4, Lecture Notes in Mathematics Vol.~1703, 1999.

% wienerio procesas
% \bibitem{Durrett2000} 
% Durrett, R. Probability: theory and examples,4th edition. 
% Cambridge University % Press, ISBN 0-521-76539-0, 2000.

% ispletoti p-variacijos tyrimai
\bibitem{Young1936} 
L.~C.~Young. An inequality of the Hölder type, 
connected with Stieltjes integration
// Acta Mathematica, 67, 251-282, 1936.

% wienerio procesas
\bibitem{Karatsas1997} 
Karatsas, I. and Shreve, S. Brownian Motion and Stochastic Calculus, 2nd ed. New York: Springer-Verlag, 1997. 

%  Norvaišios p-varioan apzvalga  
\bibitem{Norvaisa2005} 
R. Norvaiša. Rough functions: $p$-variation, calculus, and index estimation. Lithuanian Mathematical Journal, 46(1):102-128, 2005.
  
% konvergavimas in p-variation norm  
\bibitem{NorvaisaRackauskas2008}
R. Norvaiša, A. Račkauskas. Convergence in law of partial sum processes in p-variation norm // Lth. Math. J., Vol. 48, No. 2, 212–227, 2008.
  
% p-variacijos indekso vertinimas
\bibitem{NorvaisaSalopek} 
R. Norvaisa, D. M. Salopek.
Estimating the $p$-variation index of a sample function: 
An application to financial data set //
Methodology And Computing In Applied Probability 
Vol.~4, Issue~1 , 27-53, 2002.   

% Qian, PHD thesis. Daug pradiniu irodymu
\bibitem{Qian}
J. Qian. The $p$-variation of partial sum processes and the empirical process // Ph.D. thesis, Tufts University, 1997.
  
% Qian, pagrindiniu rezultatu straipsnis
\bibitem{Qian1998}
J. Qian. The p-variation of partial sum processes and the empirical process // Ann. Probab. Volume 26, Number 3 (1998), 1370-1383.  
  
% R programos citavimas
\bibitem{R}
R Core Team (2014). R: A language and environment for
statistical computing. R Foundation for Statistical
Computing, Vienna, Austria. URL http://www.R-project.org/.
  
% pirma karta apibrezta p-variacija
\bibitem{Wiener1924} 
N.\ Wiener. The Quadratic Variation of a Function and 
Its Fourier Coefficients // 
Journ.\ Math.\ and Phys., MIT, 3, 73-94, 1924.

  
  
  
  
  
\end{thebibliography}






\end{document}
